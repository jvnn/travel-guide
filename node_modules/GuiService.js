function GuiService() {

  var callbacks = {}

  function getSmallSummary(item, killMarker, saveChanges) {
    var html = '<div class="small-summary">';

    if (item['name']) {
      html += "<b>" + item['name'] + "</b>";
    }
    if (item['description']) {
      html += "<br>";
      html += '<textarea id="description-small-summary" rows="4" class="description-input">'
      html += item['description'] + '</textarea>';
    }

    html += '<div class="input-controls clearfix">';

    var idDelete = getId();
    storeCallback(idDelete, function(document, param) {
      document.getElementById("input-delete-small-summary").classList.add("confirming");
      document.getElementById("input-confirmation-small-summary").classList.add("confirming");
      document.getElementById("input-save-small-summary").classList.add("confirming");
    }, null, true);

    html += '<div id="input-delete-small-summary" class="button input-delete" ' + getCallString(idDelete) + '>'
    html += '<img src="../img/delete.svg" /></div>';

    var idConfirmDelete = getId();
    storeCallback(idConfirmDelete, function(document, param) {
      killMarker();
    }, null, true);
    html += '<div id="input-confirmation-small-summary" class="button input-confirmation" ' + getCallString(idConfirmDelete) + '>'
    html += 'Sure..?</div>';

    var idSave = getId();
    storeCallback(idSave, function(document, param) {
      var newDescription = document.getElementById("description-small-summary").value;
      saveChanges(newDescription);
    }, null, true);
    html += '<div id="input-save-small-summary" class="button input-accept" ' + getCallString(idSave) + '>'
    html += '<img src="../img/accept.svg" /></div></div>';
    return html;
  }

  function getCreateNewPopup(lat, lon, callback_name) {
    var uniqueId = "newItemPopup" + lat + "-" + lon;
    var html = '<div class="create-new">';
    html += '<div class="input-label">Name</div>';
    html += '<input type="text" id="name' + uniqueId + '" class="name-input" />';
    html += '<div class="input-label">Description</div>';
    html += '<textarea id="description' + uniqueId + '" rows="4" class="description-input"></textarea>';
    html += '<div class="input-label">Tags (separate by comma)</div>';
    html += '<input type="text"  id="tags' + uniqueId + '" class="tags-input" />';
    html += '<div class="location-field">Location: ' + lat.toFixed(4) +', ' + lon.toFixed(4) + '</div>';
    html += '<div class="input-controls clearfix">';
    html += '<div class="button input-accept" onClick="' + callback_name + '">'
    html += '<img src="../img/accept.svg" /></div>';
    html += '</div>';

    var DataGetter = function() {
      this.getName = function(document) {
        return document.getElementById("name" + uniqueId).value;
      }
      this.getDescription = function(document) {
        return document.getElementById("description" + uniqueId).value;
      }
      this.getTags = function(document) {
        return document.getElementById("tags" + uniqueId).value;
      }
      this.getLocation = function() {
        return {lat: lat, lon: lon};
      }
    }
    return {html: html, dataGetter: new DataGetter()};
  }

  function call(document, id) {
    var callback = callbacks[id];
    if (callback) {
      callback.f(document, callback.p);
      if (callback.once) {
        delete callbacks[id];
      }
    }
  }

  this.getSmallSummary = getSmallSummary;
  this.getCreateNewPopup = getCreateNewPopup;
  this.call = call;


  function storeCallback(id, callback, params, oneshot) {
    callbacks[id] = {f: callback, p: params, once: oneshot};
  }

  function getId() {
    return Math.random() + "";
  }

  function getCallString(id) {
    return 'onClick="guiService.call(document, \'' + id + '\');"';
  }
}

module.exports = new GuiService;
